uniform vec3 u_light_vector;
uniform sampler2D u_texture;
uniform bool u_process_touch;
uniform float u_touch_angle;
uniform vec3 u_touch_coord;
uniform vec4 u_highlighting_color;

varying vec3 v_normal;
varying vec2 v_tex_coord;
varying vec3 v_position;

void main() {
  vec4 n_light_vector = vec4( normalize(u_light_vector), 0.0);
  vec4 n_normal = vec4( normalize(v_normal), 0.0);

  float dot_value = dot(n_light_vector, n_normal);
  float lum_value = (dot_value + 2.0) / 3.0;

  gl_FragColor = texture2D(u_texture, v_tex_coord) * lum_value;

  // Touch area highlighting.
  if (u_process_touch) {
    float angle = acos(dot( normalize(v_position), normalize(u_touch_coord) ));
    if (0.8 * u_touch_angle <= angle && angle <= u_touch_angle) {
      float alpha = u_highlighting_color[3];
      gl_FragColor = (1.0 - alpha) * gl_FragColor +
                     alpha * u_highlighting_color;
    }
  }
}
